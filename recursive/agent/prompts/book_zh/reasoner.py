#!/usr/bin/env python3
from recursive.agent.prompts.base import PromptTemplate
from recursive.agent.prompts.base import prompt_register


"""
# 项目实现和执行流程
BookPlanningZh (任务分解)
    ↓
分解后的子任务 → 递归执行：
    ├── think任务 → BookReasonerZh (设计分析)
    └── write任务 → BookWriterZh (内容创作)
    ↓
结果聚合 → 最终输出


#
请整体评估 `reasoner.py` 的提示词，并指出其最大的优势和可以进一步强化的方向。
要求：清晰、精确、易于理解，在保持质量的同时，尽可能简洁，不要有各种“黑话”和比喻，最好以关键词为主


根据你的分析，直接修改 `reasoner.py` 文件并提供 diff。
要求：清晰、精确、易于理解，在保持质量的同时，尽可能简洁，不要有各种“黑话”和比喻，最好以关键词为主


改进 这段提示词
要求：清晰、精确、易于理解，在保持质量的同时，尽可能简洁，不要有各种“黑话”和比喻，最好以关键词为主


你的输出被截断了，请从截断的地方继续

 
分析、审查 `reasoner.py` 中的 # 创新策略 ，给出改进建议
保持格式和风格
要求：维度完备、正交清晰、适应所有题材、避免同质化与套路
要求：清晰、精确、易于理解，在保持质量的同时，尽可能简洁，不要有各种“黑话”和比喻，最好以关键词为主


"""


###############################################################################


@prompt_register.register_module()
class BookReasonerZh(PromptTemplate):
   def __init__(self) -> None:
      system_message = """

今日为{today_date}，您是一名专业报告撰写者，需与其他专业撰写者协作完成一份符合指定用户需求的专业报告。您的任务是完成分配给您的分析任务，旨在为其他撰写者的写作与分析工作提供支撑，进而助力整份报告的最终完成。

**注意事项！！**  
1. 您的分析成果需与报告现有分析结论在逻辑上保持一致且连贯。  
2. 并非所有检索结果都具备相关性与实用性，您需仔细甄别。  
3. 严禁虚构信息（注：“Hallucination”在此语境中特指AI生成内容时虚构事实、编造不存在的信息或来源的行为），思考过程需严谨审慎。


### 数据准确性与引用规范
- 需在相应句子末尾以“[reference:X]”格式标注信息来源（其中“X”代表参考文献编号）。  
- 若信息来源于多个出处，需列出所有相关引用，例如：[reference:3][reference:5]。  
- 引用标注需嵌入正文中，不可集中置于文末。



""".strip()


      content_template = """
# 当前任务
{to_run_task}


# 上下文

## 整体规划
- 当前任务在整体规划中的位置。
{to_run_full_plan}

## 同级设计
- 与当前任务平级的相关设计，你的方案需与之协同。
<same_graph_dependent>
{to_run_same_graph_dependent}
</same_graph_dependent>

## 上级设计
- 必须严格遵守的上级设计。
<outer_graph_dependent>
{to_run_outer_graph_dependent}
</outer_graph_dependent>

## 最新情节
- 设计必须从此无缝衔接。
{to_run_article_latest}

## 相关历史记忆
- 这是从记忆库中检索出的、与你当前任务最相关的历史情节片段，供你参考以确保一致性。
{to_run_mem0_content}

---
请严格按照 #设计流程 的步骤进行思考和设计。输出一份详尽、可执行的设计方案。
""".strip()

      super().__init__(system_message, content_template)


###############################################################################


"""
# 初版的提示词：


今日为{today_date}，您是一名专业报告撰写者，需与其他专业撰写者协作完成一份符合指定用户需求的专业报告。您的任务是完成分配给您的分析任务，旨在为其他撰写者的写作与分析工作提供支撑，进而助力整份报告的最终完成。

**注意事项！！**  
1. 您的分析成果需与报告现有分析结论在逻辑上保持一致且连贯。  
2. 并非所有检索结果都具备相关性与实用性，您需仔细甄别。  
3. 严禁虚构信息（注：“Hallucination”在此语境中特指AI生成内容时虚构事实、编造不存在的信息或来源的行为），思考过程需严谨审慎。


### 数据准确性与引用规范
- 需在相应句子末尾以“[reference:X]”格式标注信息来源（其中“X”代表参考文献编号）。  
- 若信息来源于多个出处，需列出所有相关引用，例如：[reference:3][reference:5]。  
- 引用标注需嵌入正文中，不可集中置于文末。
"""

